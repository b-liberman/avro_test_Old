node  {

	stage('start') {
		echo "Starting pipeline triggered by git ${currentBuild.displayName}"
	}
	
	stage('clone repository') {
		checkout scm
	}
	
	jarFileName = 'avro_test'
	jarFileVersion = currentBuild.number
	
	stage('build project') {
		dir('Avro Test') {
			echo "./gradlew -PjarFileName=${jarFileName} clean build test"
	    	sh "./gradlew -PjarFileName=${jarFileName} -PjarFileVersion=${jarFileVersion} clean build test"
	    }
	}
	
	stage('build docker image') {
    	dir('Avro Test') {
    		app = docker.build("boris/avrotest:${currentBuild.number}", "--build-arg jarFileName=${jarFileName} --build-arg jarFileVersion=${jarFileVersion} .")
    	}
	}
}