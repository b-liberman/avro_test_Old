node  {

	stage('start') {
		echo 'Starting pipeline triggered by git'
	}
	
	stage('clone repository') {
		checkout scm
	}
	jarFileName = 'avro_test'
	stage('build project') {
		dir('Avro Test') {
			echo "./gradlew -PjarFileName=${jarFileName} clean build test"
	    	sh "./gradlew -PjarFileName=${jarFileName} clean build test"
	    }
	}
	
	stage('build docker image') {
		dir('Avro Test') {
	    	withEnv(["jarFileName=${jarFileName}XX"]) {
	    		sh 'printenv'
	    		app = docker.build("boris/avrotest")
	    	}
	    }
	}
}