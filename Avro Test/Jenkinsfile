node  {

	stage('start') {
		echo 'Starting pipeline triggered by git'
	}
	
	stage('clone repository') {
		checkout scm
	}
	jarFileName = 'avro-test'
	stage('build project') {
		dir('Avro Test') {
	    	sh "./gradlew -PjarFileName=${jarFileName} clean build test"
	    }
	}
	
	stage('build docker image') {
		dir('Avro Test') {
	    	withEnv(['jarFileName'=jarFileName]) {
	    		echo ${jarFileName}
	    		app = docker.build("boris/avrotest")
	    	}
	    }
	}
}